<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Pixel War</title>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=zx8lobio6s"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>

<div id="game-container">
    <div id="map"></div>
    <canvas id="pixelCanvas"></canvas>
    <canvas id="heatmapCanvas"></canvas>
    <canvas id="previewCanvas"></canvas>

    <div id="ui-top-left" class="glass-panel">
        <div id="login-area">
            <div style="font-size: 11px; margin-bottom: 6px; text-align: center; color: #ccc;">로그인 필요</div>
            <a href="/oauth2/authorization/kakao" class="btn-kakao">카카오 로그인</a>
        </div>
        <div id="user-info" class="hidden">
            <div class="user-badge"> <span id="nickname-display">User</span></div>
            <a href="/logout" class="btn-small" style="margin-top: 5px; display:block;">로그아웃</a>
        </div>
    </div>

    <div id="ui-top-right" class="glass-panel">
        <div class="rank-title">🏆 Top Conquerors</div>
        <div id="rank-list">
            <div style="text-align: center; font-size: 12px; color: #666;">Loading...</div>
        </div>
    </div>

    <div id="ui-cooldown-overlay">
        <span class="timer-label">Wait</span>
        <span id="timerText" class="timer-text">0</span>
        <span class="timer-label">sec</span>
    </div>

    <div id="ui-chat" class="glass-panel">
        <div id="chat-header">
            <span class="chat-title">Live Chat</span>
            <i id="chat-toggle-icon" class="fas fa-chevron-down"></i>
        </div>
        <div id="chat-messages">
            <div class="msg-system">채팅방에 연결되었습니다.</div>
        </div>
        <div id="chat-input-area">
            <input type="text" id="chatInput" placeholder="메시지 입력..." maxlength="50" disabled>
            <button id="chatSendBtn" disabled>전송</button>
        </div>
    </div>

    <div id="ui-bottom-bar" class="glass-panel">
        <div class="color-container" title="색상 변경"><input type="color" id="colorPicker" value="#FF4500"></div>
        <div class="divider"></div>
        <button id="modeBtn" class="btn-main-action mode-move">📍이동 모드</button>
        <div class="divider"></div>
        <button id="cameraLockBtn" class="active-lock" title="화면 고정/해제">🔒</button>
        <div class="divider"></div>
        <button id="heatmapBtn" title="히트맵 모드">🔥</button>
        <div class="divider"></div>
        <button id="guildBtn" title="길드(팀) 관리">🛡️</button>
        <div class="divider"></div>
        <button id="myLocBtn">내 위치</button>
    </div>

    <div id="minimap-container">
        <div id="minimap-camera-box"></div>
        <div id="mini-map-view"></div>
    </div>

    <div id="blueprint-edit-ui" class="glass-panel hidden" style="position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%); z-index: 500; padding: 20px; text-align: center; width: 320px;">
        <h3 style="margin:0 0 10px 0; color:var(--gold);">🛠️ 도안 배치 모드</h3>
        <p style="font-size:12px; color:#ccc; margin-bottom:15px;">지도를 움직여 십자선에 위치를 맞추고, 크기를 조절하세요.</p>

        <div style="margin-bottom: 15px; display:flex; align-items:center; gap:10px;">
            <span style="font-size:12px; font-weight:bold;">크기 배율</span>
            <input type="range" id="blueprintScaleSlider" min="1" max="10" step="1" value="1" style="flex:1;">
            <span id="scaleValueDisplay" style="font-size:12px; font-weight:bold; width:30px;">1배</span>
        </div>

        <div style="display:flex; gap:10px;">
            <button id="cancelBlueprintBtn" style="flex:1; padding:10px; background:#555; color:white; border:none; border-radius:6px; cursor:pointer;">취소</button>
            <button id="confirmBlueprintBtn" style="flex:1; padding:10px; background:var(--accent-color); color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold;">이 위치에 저장</button>
        </div>
    </div>
</div>

<div id="guild-modal" class="glass-panel hidden">
    <div class="modal-header">
        <span>🛡️ Guild System</span>
        <button id="closeGuildBtn">✖</button>
    </div>

    <div id="view-no-guild">
        <div class="guild-tabs">
            <button class="tab-btn active" onclick="showTab('list')">길드 목록</button>
            <button class="tab-btn" onclick="showTab('create')">길드 생성</button>
        </div>
        <div id="tab-guild-list" class="tab-content">
            <div id="guild-list-container"></div>
        </div>
        <div id="tab-guild-create" class="tab-content hidden">
            <div style="text-align:center; margin-bottom:15px; font-size:12px; color:#aaa;">최대 30명의 동료와 함께하세요!</div>
            <input type="text" id="guildNameInput" placeholder="길드 이름 (필수, 10자 이내)" maxlength="10">
            <input type="text" id="guildDescInput" placeholder="한줄 소개 (선택, 30자 이내)" maxlength="30">
            <button id="createGuildActionBtn" class="btn-full">길드 창설하기</button>
        </div>
    </div>

    <div id="view-has-guild" class="hidden" style="padding: 20px; text-align: center;">
        <div style="font-size: 12px; color: #aaa; margin-bottom: 5px;">MY GUILD</div>
        <h2 id="my-guild-name" style="margin: 0; color: var(--gold); font-size: 24px;">Guild Name</h2>
        <p id="my-guild-desc" style="color: #ddd; font-size: 14px; margin: 10px 0;">Description</p>

        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin: 20px 0;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span style="color:#aaa;">Guild Master</span>
                <span id="my-guild-master" style="color:#fff; font-weight:bold;">MasterName</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span style="color:#aaa;">Members</span>
                <span id="my-guild-count" style="color:#fff;">0 / 30</span>
            </div>
        </div>

        <div style="margin: 20px 0; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <span style="font-weight: bold; color: var(--accent-color);">🗺️ 길드 도안</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="blueprintToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>

            <div id="blueprint-setup-area" class="hidden" style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px;">
                <input type="file" id="blueprintFileInput" accept="image/*" style="width: 100%; margin-bottom: 10px; box-sizing: border-box; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 6px; border-radius: 4px;">

                <div style="display: flex; gap: 8px;">
                    <button id="startEditBlueprintBtn" style="flex: 3; background: var(--accent-color); color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-weight: bold;">🗺️ 도안 배치 / 변경</button>
                    <button id="deleteBlueprintBtn" class="hidden" style="flex: 1; background: #ff4757; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-weight: bold;">🗑️ 삭제</button>
                </div>
            </div>
        </div>

        <button class="btn-leave" onclick="leaveGuild()" style="width: 100%; padding: 12px;">길드 탈퇴하기</button>
    </div>
</div>

<img id="blueprintImage" src="" crossorigin="anonymous" style="display: none;">
<script src="script.js"></script>
</body>
</html>